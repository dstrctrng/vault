#!/bin/bash -e

pth_install=$1; shift

# initialize the vault
if [[ ! -d $pth_install ]]; then
  git clone https://github.com/HeSYINUvSBZfxqA/vault $pth_install
fi

# uppdate the vault
pushd $pth_install > /dev/null
git pull origin master
popd > /dev/null

# cache software
rsync -ia software/. $pth_install/software/ --delete

# cache repositories
rsync -ia git/. $pth_install/git/ --delete

# cache boxes
rsync -ia --no-t virtualbox/boxes $pth_install/virtualbox/

# cache ports packages
for a in *; do
  if [[ -d $a/software ]]; then
    rsync -ia --no-t $a/software $pth_install/$a/
  fi
done

